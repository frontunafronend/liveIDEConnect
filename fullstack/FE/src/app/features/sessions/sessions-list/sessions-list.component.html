<div class="sessions-page">
  <app-header></app-header>
  
  <header class="sessions-page__header">
    <div class="sessions-page__header-content">
      <div>
        <h1 class="sessions-page__title">IDE Sessions</h1>
        <p class="sessions-page__subtitle">Manage your connected development environments</p>
      </div>
      <app-button
        variant="primary"
        (click)="openCreateModal()"
      >
        + New Session
      </app-button>
    </div>
  </header>

  <!-- Create Session Modal -->
  <app-modal
    [isOpen]="showModal()"
    title="Create New Session"
    (closeModal)="closeModal()"
  >
    <form (ngSubmit)="createSession()" class="create-session-form">
      <app-input
        type="text"
        label="Session Name"
        placeholder="My Test Session"
        [(value)]="sessionName"
      />

      <app-input
        type="password"
        label="Authentication Token *"
        placeholder="Enter your JWT token"
        [required]="true"
        [(value)]="sessionToken"
      />

      <div class="create-session-form__hint">
        <p>üí° Tip: Your token is automatically filled from your current session.</p>
        <p>To get it manually: <code>sessionStorage.getItem('auth_token')</code></p>
      </div>

      <div class="create-session-form__actions">
        <app-button
          type="button"
          variant="outline"
          (click)="closeModal()"
          [disabled]="isCreating()"
        >
          Cancel
        </app-button>
        <app-button
          type="submit"
          variant="primary"
          [disabled]="isCreating() || !sessionToken().trim()"
        >
          @if (isCreating()) {
            Creating...
          } @else {
            Create & Connect
          }
        </app-button>
      </div>
    </form>
  </app-modal>

  <main class="sessions-page__main">
    <div class="sessions-page__container">
      @if (sessions().length === 0) {
        <div class="sessions-page__empty">
          <p>No sessions available. Connect your IDE to get started.</p>
        </div>
      } @else {
        <div class="sessions-page__grid">
          @for (session of sessions(); track session.id) {
            <app-card class="session-item">
              <div class="session-item__content" (click)="onSessionClick(session)">
                <div class="session-item__header">
                  <h3 class="session-item__name">{{ session.name }}</h3>
                  <span [class]="getStatusClass(session.status)">
                    {{ getStatusLabel(session.status) }}
                  </span>
                </div>
                <p class="session-item__meta">
                  Last active: {{ formatLastActive(session.lastActive) }}
                </p>
              </div>
              <button
                class="session-item__delete"
                (click)="onDeleteClick($event, session)"
                aria-label="Delete session"
                title="Delete session"
              >
                üóëÔ∏è
              </button>
            </app-card>
          }
        </div>
      }
    </div>
  </main>
</div>

