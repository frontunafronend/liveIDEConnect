<div class="sessions-page">
  <header class="sessions-page__header">
    <div>
      <h1 class="sessions-page__title">Sessions Monitor</h1>
      <p class="sessions-page__subtitle">View all active IDE sessions and their status</p>
    </div>
    <app-button
      variant="primary"
      (click)="openCreateModal()"
    >
      + New Session
    </app-button>
  </header>

  <!-- Create Session Modal -->
  <app-modal
    [isOpen]="showModal()"
    title="Create New Session"
    (closeModal)="closeModal()"
  >
    <form (ngSubmit)="createSession()" class="create-session-form">
      <app-input
        type="text"
        label="Session Name"
        placeholder="My Test Session"
        [(value)]="sessionName"
      />

      <app-input
        type="password"
        label="Authentication Token *"
        placeholder="Enter your JWT token"
        [required]="true"
        [(value)]="sessionToken"
      />

      <div class="create-session-form__hint">
        <p>üí° Tip: Your token is automatically filled from your current session.</p>
        <p>To get it manually: <code>sessionStorage.getItem('auth_token')</code></p>
      </div>

      <div class="create-session-form__actions">
        <app-button
          type="button"
          variant="outline"
          (click)="closeModal()"
          [disabled]="isCreating()"
        >
          Cancel
        </app-button>
        <app-button
          type="submit"
          variant="primary"
          [disabled]="isCreating() || !sessionToken().trim()"
        >
          @if (isCreating()) {
            Creating...
          } @else {
            Create & Connect
          }
        </app-button>
      </div>
    </form>
  </app-modal>

  @if (isLoading) {
    <app-skeleton-loader type="table" [lines]="5"></app-skeleton-loader>
  } @else {
    <div class="sessions-page__table">
      <table class="sessions-table">
        <thead class="sessions-table__head">
          <tr>
            <th>Session Name</th>
            <th>User</th>
            <th>Status</th>
            <th>Last Active</th>
            <th>Created</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody class="sessions-table__body">
          @for (session of sessions(); track session.id) {
            <tr class="sessions-table__row">
              <td>{{ session.name }}</td>
              <td>
                <div class="sessions-table__user">
                  <span class="sessions-table__user-name">{{ session.user.name }}</span>
                  <span class="sessions-table__user-email">{{ session.user.email }}</span>
                </div>
              </td>
              <td>
                <span class="sessions-table__status" [ngClass]="getStatusClass(session.status)">
                  {{ session.status }}
                </span>
              </td>
              <td>{{ formatDate(session.lastActive) }}</td>
              <td>{{ formatDate(session.createdAt) }}</td>
              <td>
                <button
                  class="sessions-table__delete"
                  (click)="onDeleteClick($event, session)"
                  aria-label="Delete session"
                  title="Delete session"
                >
                  üóëÔ∏è
                </button>
              </td>
            </tr>
          } @empty {
            <tr>
              <td colspan="6" class="sessions-table__empty">No sessions found</td>
            </tr>
          }
        </tbody>
      </table>
    </div>
  }
</div>

